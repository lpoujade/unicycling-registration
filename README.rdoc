== Welcome to the Unicycling Registration Application.

== Configuration

You must configure the following settings for each system that you run.

For Development (local) system, use the following syntax:

echo "<variable>=<value>" >> .env

For Production (heroku) system, use the following syntax:

heroku config:add <variable>=<value>


== Set the configuration variables (for local work)

These are necessary to get a local environment configured, but are not needed on heroku.

echo "RACK_ENV=development" > .env
echo "PORT=9292" >> .env


== Email system

The following is used to configure the outgoing e-mail system.
Specify a real email account, with username and password.
The "Full E-mail" will be the e-mail address in the "From" line.

MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_DOMAIN=dunlopweb.com
MAIL_USERNAME=robin@dunlopweb.com
MAIL_PASSWORD=something
MAIL_FULL_EMAIL=robin@dunlopweb.com

On Non-GMail systems, you may need to set the MAIL_TLS=false variable too (see initializers/mailer.rb)

The following e-mail will receive a CC of every payment confirmation sent
PAYMENT_NOTICE_EMAIL=robin+nauccpayments@dunlopweb.com

The following e-mail will receive all error messages and other low-level messages
ERROR_EMAIL=robin+nauccerrors@dunlopweb.com

== Domain

The following setting is used to build the links in the e-mails, set it to the hostname of the deployed application

DOMAIN=uniregtest.herokuapp.com

or 

DOMAIN=localhost:9292

== Paypal Account

Specify the paypal account "Merchan account" that will be paid.

PAYPAL_ACCOUNT=robin@dunlopweb.com

Specify whether to use the LIVE or TEST PAYPAL ACCOUNT (default: Test)

PAYPAL_TEST=false

== Mixpanel Account

Mixpanel is a service for tracking the way that users interact with the site.

Adding a mixpanel token enables us to track the flow of users.

MIXPANEL_TOKEN=<token>


== Secret hash

The 'Secret' key is required in order to generate secure cookies. With this in place, users can return to the site and have their accounts still logged in (this is a good thing).

SECRET=`rake secret`

(I use 'rake secret' (with backticks) to generate a random secure value. I only run it once, and it should be a different value for your production system)


= Deploying to Heroku

1. Create a new heroku instance
        <tt>heroku create cedar,.....something</tt>

2. Upload the code
        <tt>git push heroku master</tt>

3. Install the pgbackups addon (so that you can take backups/dumps)
        <tt> heroku addons:add pgbackups</tt>


== Backup data from the heroku instance

1. Create a snapshot (assuming that the heroku app is named uniregtest)
        <tt>heroku pgbackups:capture --expire --app uniregtest</tt>

2. Download the backup
        <tt>curl -o latest.dump `heroku pgbackups:url --app uniregtest`</tt>

3. Import the data (from inside your VM)
        <tt>PGPASSWORD=password pg_restore --verbose --clean --no-acl --no-owner -h localhost -U postgres -d app_development latest.dump</tt>


== Configure for integration with Paypal

1. Set the merchant account in the environment variables
      echo "PAYPAL_ACCOUNT=robin@dunlopweb.com" >> .env

      heroku config:add PAYPAL_ACCOUNT=robin@dunlopweb.com

      Disable paypal test mode using PAYPAL_TEST=false (see above)

2. Configure your paypal account to send out IPN notifications;
  The <notification url> will be the hosted website URL, with /payments/notification at the end. Example: http://uniregtest.herokuapp.com/payments/notification

. Login to merchant account -> Profile -> Instant Payment Notification Preferences -> Enter <notification url> and select radio button “Receive IPN messages” -> Save

3. Enable Auto Return:
  <return_url> will be http://uniregtest.herokuapp.com/payments/

  "My Account -> Profile -> Sellers Preferences -> Website Payment Preferences -> Payment Data Transfer On), Auto Return ON: Return URL: <return_url>

4. Set the "PayPal Account Optional" setting on so that people don't have to have a paypal account to pay
  "My Account -> PRofile -> Sellers Preferences -> Website Payment Preferences -> PayPal Account Optional (On) -> save"

