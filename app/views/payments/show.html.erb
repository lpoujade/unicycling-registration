
<p>
  <b>PaymentID:</b>
  <%= @payment.id %>
</p>

<p>
  <b>Completed:</b>
  <%= @payment.completed %>
</p>
<p>
  <b>Cancelled:</b>
  <%= @payment.cancelled %>
</p>

<p>
  <b>TransactionID:</b>
  <%= @payment.transaction_id %>
</p>

<p>
  <b>Completed date:</b>
  <%= @payment.completed_date %>
</p>

<table>
  <caption>Payment Details:</caption>
  <thead>
    <tr>
      <td>Registrant</td>
      <td>Item</td>
      <td>Cost</td>
    </tr>
  </thead>
  <tbody>
    <% @payment.payment_details.each do |pd| %>
      <tr>
        <td>
          <%= pd.registrant %>
        </td>
        <td>
          <%= pd.expense_item %>
        </td>
        <td>
          <%= pd.amount %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div>
  <%= form_tag @payment.paypal_post_url do %>
    <%= hidden_field_tag :business, ENV["PAYPAL_ACCOUNT"] %>
    <%= hidden_field_tag :cancel_return, payments_url %>
    <%= hidden_field_tag :cmd, "_cart" %>
    <%= hidden_field_tag :currency_code, "USD" %>
    <%= hidden_field_tag :invoice, @payment.id.to_s %>
    <%= hidden_field_tag :no_shipping, "2" %>
    <%= hidden_field_tag :notify_url, notification_payments_url %>
    <%= hidden_field_tag :return, payments_url %>
    <%= hidden_field_tag :upload, "1" %>
    <% @payment.payment_details.each_with_index do |pd, index| %>
      <%= hidden_field_tag "amount_#{index + 1}", pd.amount.to_s %>
      <%= hidden_field_tag "item_name_#{index + 1}", pd.expense_item.to_s %>
      <%= hidden_field_tag "quantity_#{index + 1}", "1" %>
    <% end %>
    <%= submit_tag "Pay with Paypal", :class => "registration_button", :confirm => "This functionality is still being developed. Continue?" %>
  <% end %>
</div>

<% if @config.test_mode %>
  <div class="test_mode">
    <%= link_to 'Pretend to pay by credit card', fake_complete_payment_path(@payment), :method => :post %>
  </div>
<% end %>


<%= link_to 'Edit', edit_payment_path(@payment) %> |
<%= link_to 'Back', payments_path %>
