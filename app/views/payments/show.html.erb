<script type="text/javascript">
    mixpanel.track_forms("form", "Paypal Payment Started")
</script>

<h1>Payment Summary</h1>
<%= render :partial => "summary", :locals => {:payment => @payment } %>


Please proceed with your payment:
<div>
  <%= form_tag @payment.paypal_post_url do %>
    <%= hidden_field_tag :business, ENV["PAYPAL_ACCOUNT"] %>
    <%= hidden_field_tag :cancel_return, payments_url %>
    <%= hidden_field_tag :cmd, "_cart" %>
    <%= hidden_field_tag :currency_code, "USD" %>
    <%= hidden_field_tag :invoice, @payment.id.to_s %>
    <%= hidden_field_tag :no_shipping, "2" %>
    <%= hidden_field_tag :notify_url, notification_payments_url %>
    <%= hidden_field_tag :return, success_payments_url %>
    <%= hidden_field_tag :upload, "1" %>
    <% @payment.payment_details.each_with_index do |pd, index| %>
      <%= hidden_field_tag "amount_#{index + 1}", pd.amount.to_s %>
      <%= hidden_field_tag "item_name_#{index + 1}", pd.expense_item.to_s %>
      <%= hidden_field_tag "quantity_#{index + 1}", "1" %>
    <% end %>
    <%= submit_tag "Pay with Paypal", :class => "registration_button", :confirm => "This functionality is still being developed. Continue?" %>
  <% end %>
</div>

<% if @config.test_mode %>
  <div class="test_mode">
    <%= link_to 'Pretend to pay by credit card', fake_complete_payment_path(@payment), :method => :post %>
  </div>
<% end %>


<%= link_to 'Back', payments_path %>
