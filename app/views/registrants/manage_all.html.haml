.non_printable
  - if can? :bag_labels, Registrant
    = link_to 'Bag Labels PDF', bag_labels_registrants_path
    %br
  = link_to '(pdf)', manage_all_registrants_path(:format => :pdf)
  %br
  - if can? :show_all, Registrant
    = link_to "All Registrants Summaries (pdf)", show_all_registrants_path(:format => :pdf)

%h1 Edit Registrants

%table.sortable.searchable
  %thead
    %tr
      %th ID
      %th Last Name
      %th First Name
      %th Age
      %th Gender
      - if @config.usa?
        %th State
      - else
        %th Country
      %th.non_printable Summary
      %th.non_printable Edit
      %th.non_printable Deleted?
      %th.non_printable User
  %tbody
    // # includes 'current_user' because of the 'can? Calls
    - cache ['index_all.registrant', I18n.locale, Registrant, current_user, @config ] do
      - @registrants.find_each(batch_size: 100) do |registrant|
        - if can? :edit, registrant
          %span.js--showElement{ data: { key: "edit_registrant#{registrant.id}" } }
        - if can? :reg_fee, registrant
          %span.js--showElement{ data: { key: "reg_fee#{registrant.id}" } }
        - if can? :undelete, registrant
          %span.js--showElement{ data: { key: "undelete#{registrant.id}" } }
        - cache [I18n.locale, registrant, @config] do
          %tr
            %td= registrant.bib_number
            %td= registrant.last_name
            %td= registrant.first_name
            %td= registrant.age
            %td= registrant.gender
            - if @config.usa?
              %td= registrant.state
            - else
              %td= registrant.country
            %td.non_printable
              = link_to "Summary", registrant_path(registrant)
              = link_to "(pdf)", registrant_path(registrant, :format => :pdf)
            %td.non_printable
              %span.js--showElementTarget{ data: { key: "edit_registrant#{registrant.id}" } }
                = link_to "Events", registrant_build_path(registrant, :add_events)
                = link_to "Items", registrant_build_path(registrant, :expenses)
              %span.js--showElementTarget{ data: { key: "reg_fee#{registrant.id}" } }
                = link_to "Reg Fee", reg_fee_registrant_path(registrant)
            %td.non_printable
              %span.js--showElementTarget{ data: { key: "undelete#{registrant.id}" } }
              - if registrant.deleted
                = link_to 'Undelete', undelete_registrant_path(registrant), :method => :post, data: { confirm: "Undelete this registrant?" }
            %td.non_printable= registrant.user
